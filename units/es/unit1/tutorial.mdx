# Vamos Crear Nuestro Primer Agente Usando smolagents

En la √∫ltima secci√≥n, aprendimos c√≥mo podemos crear Agentes desde cero usando c√≥digo Python, y **vimos lo tedioso que puede ser ese proceso**. Afortunadamente, muchas librer√≠as de Agentes simplifican este trabajo **manejando gran parte del trabajo pesado por ti**.

En este tutorial, **crear√°s tu primer Agente** capaz de realizar acciones como generaci√≥n de im√°genes, b√∫squeda web, verificaci√≥n de zonas horarias y mucho m√°s.

Tambi√©n publicar√°s tu agente **en un Space de Hugging Face para que puedas compartirlo con amigos y colegas**.

¬°Comencemos!


## ¬øQu√© es smolagents?

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/smolagents.png" alt="smolagents"/>

Para crear este Agente, vamos a usar `smolagents`, una librer√≠a que **proporciona un marco para desarrollar tus agentes con facilidad**.

Esta librer√≠a ligera est√° dise√±ada para ser simple, pero abstrae gran parte de la complejidad de construir un Agente, permiti√©ndote enfocarte en dise√±o el comportamiento de tu agente.

Profundizaremos m√°s en smolagents en la siguiente Unidad. Mientras tanto, tambi√©n puedes consultar esta <a href="https://huggingface.co/blog/smolagents" target="_blank">publicaci√≥n del blog</a> o el <a href="https://github.com/huggingface/smolagents" target="_blank">repositorio de la librer√≠a en GitHub</a>.

En resumen, `smolagents` es una librer√≠a que se enfoca en **codeAgent**, un tipo de agente que realiza **"Acciones"** a trav√©s de bloques de c√≥digo, y luego **"Observa"** los resultados ejecutando el c√≥digo.

¬°Aqu√≠ un ejemplo de lo que construiremos!

Proporcionamos a nuestro agente una **herramienta de generaci√≥n de im√°genes** y le pedimos que genere una imagen de un gato.

El agente dentro de `smolagents` va a tener los **mismos comportamientos que el personalizado que construimos anteriormente**: va a **pensar, actuar y observar en ciclo** hasta que llegue a una respuesta final:

<iframe width="560" height="315" src="https://www.youtube.com/embed/PQDKcWiuln4?si=ysSTDZoi8y55FVvA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

Emocionante, ¬øcierto?

## ¬°Construyamos nuestro Agente!

Para comenzar, duplica este Space: <a href="https://huggingface.co/spaces/agents-course/First_agent_template" target="_blank">https://huggingface.co/spaces/agents-course/First_agent_template</a>
> ¬°Gracias a <a href="https://huggingface.co/m-ric" target="_blank">Aymeric</a> por esta plantilla! üôå


Duplicar este space significa **crear una copia local en tu propio perfil**:
<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/duplicate-space.gif" alt="Duplicate"/>

A lo largo de esta lecci√≥n, el √∫nico archivo que necesitar√°s modificar es el (actualmente incompleto) **"app.py"**. Puedes ver aqu√≠ el [original en la plantilla](https://huggingface.co/spaces/agents-course/First_agent_template/blob/main/app.py). Para encontrar el tuyo, ve a tu copia del space, luego haz clic en la pesta√±a `Files` y luego en `app.py` en el listado de directorios.

Analicemos el c√≥digo juntos:

- El archivo comienza con algunas importaciones de bibliotecas simples pero necesarias

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, InferenceClientModel, load_tool, tool
import datetime
import requests
import pytz
import yaml
from tools.final_answer import FinalAnswerTool
```

Como se describi√≥ anteriormente, usaremos directamente la clase **CodeAgent** de **smolagents**.


### Las Herramientas

¬°Ahora vamos con las herramientas! Si quieres un repaso sobre las herramientas, no dudes en volver a la secci√≥n [Herramientas](tools) del curso.

```python
@tool
def my_custom_tool(arg1:str, arg2:int)-> str: # es importante especificar el tipo que se regresara
    # Mant√©n este formato para la descripci√≥n de la herramienta / descripci√≥n de args pero si√©ntete libre de modificar la herramienta
    """Una herramienta que aun no hace nada 
    Args:
        arg1: el primer argumento
        arg2: el segundo argumento
    """
    return "¬øQu√© magia construir√°s?"

@tool
def get_current_time_in_timezone(timezone: str) -> str:
    """Una herramienta que obtiene la hora local actual en una zona horaria especificada.
    Args:
        timezone: Una cadena que representa una zona horaria v√°lida (por ejemplo, 'America/New_York').
    """
    try:
        # Crear objeto de zona horaria
        tz = pytz.timezone(timezone)
        # Obtener la hora actual en esa zona horaria
        local_time = datetime.datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
        return f"La hora local actual en {timezone} es: {local_time}"
    except Exception as e:
        return f"Error al obtener la hora para la zona horaria '{timezone}': {str(e)}"
```


Las Herramientas son lo que te estamos animando a construir en esta secci√≥n. Te damos dos ejemplos:

1. Una **Herramienta ficticia que no funciona** que puedes modificar para hacer algo √∫til.
2. Una **Herramienta que realmente funciona** que obtiene la hora actual en alg√∫n lugar del mundo.

Para definir tu herramienta es importante:

1. Proporcionar tipos de entrada y salida para tu funci√≥n, como en `get_current_time_in_timezone(timezone: str) -> str:`
2. **Un docstring formateado**. `smolagents` espera que todos los argumentos tengan una **descripci√≥n textual en el docstring**.

### El Agente

Utiliza [`Qwen/Qwen2.5-Coder-32B-Instruct`](https://huggingface.co/Qwen/Qwen2.5-Coder-32B-Instruct) como motor LLM. Este es un modelo muy capaz al que accederemos a trav√©s de la API sin servidor.

```python
final_answer = FinalAnswerTool()
model = InferenceClientModel(
    max_tokens=2096,
    temperature=0.5,
    model_id='Qwen/Qwen2.5-Coder-32B-Instruct',
    custom_role_conversions=None,
)

with open("prompts.yaml", 'r') as stream:
    prompt_templates = yaml.safe_load(stream)
    
# Estamos creando nuestro CodeAgent
agent = CodeAgent(
    model=model,
    tools=[final_answer], # a√±ade tus herramientas aqu√≠ (no elimines final_answer)
    max_steps=6,
    verbosity_level=1,
    grammar=None,
    planning_interval=None,
    name=None,
    description=None,
    prompt_templates=prompt_templates
)

GradioUI(agent).launch()
```

¬°Este Agente todav√≠a usa el `InferenceClient` que vimos en una secci√≥n anterior detr√°s de la clase **InferenceClientModel**!

Daremos ejemplos m√°s detallados cuando presentemos el marco en la Unidad 2. Por ahora, debes enfocarte en **agregar nuevas herramientas a la lista de herramientas** usando el par√°metro `tools` de tu Agente.

Por ejemplo, podr√≠as usar el `DuckDuckGoSearchTool` que se import√≥ en la primera l√≠nea del c√≥digo, o puedes examinar el `image_generation_tool` que se carga desde el Hub m√°s adelante en el c√≥digo.

**Agregar herramientas le dar√° a tu agente nuevas capacidades**, ¬°intenta ser creativo aqu√≠!

El "app.py" completo: 

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, InferenceClientModel, load_tool, tool
import datetime
import requests
import pytz
import yaml
from tools.final_answer import FinalAnswerTool

from Gradio_UI import GradioUI

# A continuaci√≥n hay un ejemplo de una herramienta que no hace nada. ¬°Sorpr√©ndenos con tu creatividad!
@tool
def my_custom_tool(arg1:str, arg2:int)-> str: # es importante especificar el tipo de retorno
    # Mant√©n este formato para la descripci√≥n de la herramienta / descripci√≥n de args pero si√©ntete libre de modificar la herramienta
    """Una herramienta que a√∫n no hace nada 
    Args:
        arg1: el primer argumento
        arg2: el segundo argumento
    """
    return "¬øQu√© magia construir√°s?"

@tool
def get_current_time_in_timezone(timezone: str) -> str:
    """Una herramienta que obtiene la hora local actual en una zona horaria especificada.
    Args:
        timezone: Una cadena que representa una zona horaria v√°lida (por ejemplo, 'America/New_York').
    """
    try:
        # Crear objeto de zona horaria
        tz = pytz.timezone(timezone)
        # Obtener la hora actual en esa zona horaria
        local_time = datetime.datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
        return f"La hora local actual en {timezone} es: {local_time}"
    except Exception as e:
        return f"Error al obtener la hora para la zona horaria '{timezone}': {str(e)}"


final_answer = FinalAnswerTool()
model = InferenceClientModel(
max_tokens=2096,
temperature=0.5,
model_id='Qwen/Qwen2.5-Coder-32B-Instruct',
custom_role_conversions=None,
)


# Importar herramienta desde Hub
image_generation_tool = load_tool("agents-course/text-to-image", trust_remote_code=True)

with open("prompts.yaml", 'r') as stream:
    prompt_templates = yaml.safe_load(stream)
    
agent = CodeAgent(
    model=model,
    tools=[final_answer], # a√±ade tus herramientas aqu√≠ (no elimines final_answer)
    max_steps=6,
    verbosity_level=1,
    grammar=None,
    planning_interval=None,
    name=None,
    description=None,
    prompt_templates=prompt_templates
)


GradioUI(agent).launch()
```

Tu **Objetivo** es familiarizarte con el Space y el Agente. 

Actualmente, el agente en la plantilla **no utiliza ninguna herramienta, as√≠ que intenta proporcionarle algunas de las prefabricadas o incluso crear algunas herramientas nuevas t√∫ mismo.**

¬°Estamos esperando ansiosamente tus incre√≠bles resultados de agentes en el canal de Discord **#agents-course-showcase**!


---
¬°Felicidades, has construido tu primer Agente! No dudes en compartirlo con tus amigos y colegas.

Como este es tu primer intento, es perfectamente normal si es un poco inestable o lento. En futuras unidades, aprenderemos c√≥mo construir Agentes a√∫n mejores.

La mejor manera de aprender es intentarlo, as√≠ que no dudes en actualizarlo, agregar m√°s herramientas, probar con otro modelo, etc.

En la siguiente secci√≥n, completar√°s el Quiz final y obtendr√°s tu certificado.
