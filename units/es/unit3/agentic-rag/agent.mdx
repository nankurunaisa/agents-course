# Creando tu Agente para la Gala

Ahora que hemos construido todos los componentes necesarios para Alfred, es momento de unirlos en un agente completo que pueda ayudar a organizar nuestra extravagante gala.

En esta secci√≥n, combinaremos la recuperaci√≥n de informaci√≥n de invitados, b√∫squeda web, informaci√≥n meteorol√≥gica y herramientas de estad√≠sticas de Hub en un solo agente poderoso.

## Ensamblando a Alfred: El Agente Completo

En lugar de reimplementar todas las herramientas que creamos en secciones anteriores, las importaremos desde sus respectivos m√≥dulos que guardamos en los archivos `tools.py` y `retriever.py`.

<Tip>
Si a√∫n no has implementado las herramientas, regresa a las secciones de <a href="./tools">herramientas</a> y <a href="./invitees">recuperador</a> para implementarlas, y agr√©galas a los archivos <code>tools.py</code> y <code>retriever.py</code>.
</Tip>

Importemos las bibliotecas y herramientas necesarias de las secciones anteriores:

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
# Importar librer√≠as necesarias
import random
from smolagents import CodeAgent, InferenceClientModel

# Importar nuestras herramientas personalizadas desde sus m√≥dulos
from tools import DuckDuckGoSearchTool, WeatherInfoTool, HubStatsTool
from retriever import load_guest_dataset
```

Ahora, combinemos todas estas herramientas en un solo agente:

```python
# Inicializar el modelo de Hugging Face
model = InferenceClientModel()

# Inicializar la herramienta de b√∫squeda web
search_tool = DuckDuckGoSearchTool()

# Inicializar la herramienta del clima
weather_info_tool = WeatherInfoTool()

# Inicializar la herramienta de estad√≠sticas de Hub
hub_stats_tool = HubStatsTool()

# Cargar el conjunto de datos de invitados e inicializar la herramienta de informaci√≥n de invitados
guest_info_tool = load_guest_dataset()

# Crear a Alfred con todas las herramientas
alfred = CodeAgent(
    tools=[guest_info_tool, weather_info_tool, hub_stats_tool, search_tool], 
    model=model,
    add_base_tools=True,  # Agregar cualquier herramienta base adicional
    planning_interval=3   # Habilitar planificaci√≥n cada 3 pasos
)
```

</hfoption>
<hfoption id="llama-index">

```python
# Importar librer√≠as necesarias
from llama_index.core.agent.workflow import AgentWorkflow
from llama_index.llms.huggingface_api import HuggingFaceInferenceAPI

from tools import search_tool, weather_info_tool, hub_stats_tool
from retriever import guest_info_tool
```

Ahora, combinemos todas estas herramientas en un solo agente:

```python
# Inicializar el modelo de Hugging Face
llm = HuggingFaceInferenceAPI(model_name="Qwen/Qwen2.5-Coder-32B-Instruct")

# Crear Alfred con todas las herramientas
alfred = AgentWorkflow.from_tools_or_functions(
    [guest_info_tool, search_tool, weather_info_tool, hub_stats_tool],
    llm=llm,
)
```

</hfoption>
<hfoption id="langgraph">

```python
from typing import TypedDict, Annotated
from langgraph.graph.message import add_messages
from langchain_core.messages import AnyMessage, HumanMessage, AIMessage
from langgraph.prebuilt import ToolNode
from langgraph.graph import START, StateGraph
from langgraph.prebuilt import tools_condition
from langchain_huggingface import HuggingFaceEndpoint, ChatHuggingFace

from tools import DuckDuckGoSearchTool, weather_info_tool, hub_stats_tool
from retriever import load_guest_dataset
```

Ahora, combina todas estas herramientas en un solo agente:

```python
# Inicializar la herramienta de b√∫squeda web
search_tool = DuckDuckGoSearchTool()

# Cargar el conjunto de datos de invitados e inicializar la herramienta de informaci√≥n de invitados
guest_info_tool = load_guest_dataset()

# Generar la interfaz de chat, incluyendo las herramientas
llm = HuggingFaceEndpoint(
    repo_id="Qwen/Qwen2.5-Coder-32B-Instruct",
    huggingfacehub_api_token=HUGGINGFACEHUB_API_TOKEN,
)

chat = ChatHuggingFace(llm=llm, verbose=True)
tools = [guest_info_tool, search_tool, weather_info_tool, hub_stats_tool]
chat_with_tools = chat.bind_tools(tools)

# Generar el AgentState y el grafo del Agente
class AgentState(TypedDict):
    messages: Annotated[list[AnyMessage], add_messages]

def assistant(state: AgentState):
    return {
        "messages": [chat_with_tools.invoke(state["messages"])],
    }

## El grafo
builder = StateGraph(AgentState)

# Definir nodos: estos hacen el trabajo
builder.add_node("assistant", assistant)
builder.add_node("tools", ToolNode(tools))

# Definir bordes: estos determinan c√≥mo se mueve el flujo de control
builder.add_edge(START, "assistant")
builder.add_conditional_edges(
    "assistant",
    # Si el √∫ltimo mensaje requiere una herramienta, enrutar a herramientas
    # De lo contrario, proporcionar una respuesta directa
    tools_condition,
)
builder.add_edge("tools", "assistant")
alfred = builder.compile()
```
</hfoption>
</hfoptions>

¬°Tu agente ahora est√° listo para usarse!

## Usando a Alfred: Ejemplos de Principio a Fin

Ahora que Alfred est√° completamente equipado con todas las herramientas necesarias, veamos c√≥mo puede ayudar con varias tareas durante la gala.

### Ejemplo 1: Encontrando Informaci√≥n de Invitados

Veamos c√≥mo Alfred puede ayudarnos con nuestra informaci√≥n de invitados.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
query = "Cu√©ntame sobre 'Lady Ada Lovelace'"
response = alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
Seg√∫n la informaci√≥n que recuper√©, Lady Ada Lovelace es una estimada matem√°tica y amiga. Es reconocida por su trabajo pionero en matem√°ticas y computaci√≥n, frecuentemente celebrada como la primera programadora de computadoras debido a su trabajo en el Motor Anal√≠tico de Charles Babbage. Su direcci√≥n de correo electr√≥nico es ada.lovelace@example.com.
```

</hfoption>
<hfoption id="llama-index">

```python
query = "Cu√©ntame sobre Lady Ada Lovelace. ¬øCu√°l es su historia?"
response = await alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response.response.blocks[0].text)
```

Salida esperada:

```
üé© Respuesta de Alfred:
Lady Ada Lovelace fue una matem√°tica y escritora inglesa, mejor conocida por su trabajo en el Motor Anal√≠tico de Charles Babbage. Fue la primera en reconocer que la m√°quina ten√≠a aplicaciones m√°s all√° del c√°lculo puro.
```

</hfoption>
<hfoption id="langgraph">

```python
response = alfred.invoke({"messages": "Cu√©ntame sobre 'Lady Ada Lovelace'"})

print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
```

Salida esperada:

```
üé© Respuesta de Alfred:
Ada Lovelace, tambi√©n conocida como Augusta Ada King, Condesa de Lovelace, fue una matem√°tica y escritora inglesa. Nacida el 10 de diciembre de 1815 y fallecida el 27 de noviembre de 1852, es reconocida por su trabajo en el Motor Anal√≠tico de Charles Babbage, una computadora mec√°nica de prop√≥sito general. Ada Lovelace es celebrada como una de las primeras programadoras de computadoras porque cre√≥ un programa para el Motor Anal√≠tico en 1843. Reconoci√≥ que la m√°quina pod√≠a usarse para m√°s que simples c√°lculos, visualizando su potencial de una manera que pocos hicieron en ese momento. Sus contribuciones al campo de la ciencia de la computaci√≥n sentaron las bases para desarrollos futuros. Un d√≠a en octubre, designado como el D√≠a de Ada Lovelace, honra las contribuciones de las mujeres a la ciencia y la tecnolog√≠a, inspirado en el trabajo pionero de Lovelace.
```

</hfoption>
</hfoptions>


### Ejemplo 2: Verificando el Clima para los Fuegos Artificiales

Veamos c√≥mo Alfred puede ayudarnos con el clima.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
query = "¬øC√≥mo est√° el clima en Par√≠s esta noche? ¬øSer√° adecuado para nuestro espect√°culo de fuegos artificiales?"
response = alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada (variar√° debido a la aleatoriedad):
```
üé© Respuesta de Alfred:
He revisado el clima en Par√≠s para ti. Actualmente, est√° despejado con una temperatura de 25¬∞C. Estas condiciones son perfectas para el espect√°culo de fuegos artificiales de esta noche. Los cielos despejados proporcionar√°n una excelente visibilidad para el espect√°culo espectacular, y la temperatura agradable asegurar√° que los invitados puedan disfrutar del evento al aire libre sin incomodidad.
```

</hfoption>
<hfoption id="llama-index">

```python
query = "¬øC√≥mo est√° el clima en Par√≠s esta noche? ¬øSer√° adecuado para nuestro espect√°culo de fuegos artificiales?"
response = await alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El clima en Par√≠s esta noche es lluvioso con una temperatura de 15¬∞C. Debido a la lluvia, puede que no sea adecuado para un espect√°culo de fuegos artificiales.
```

</hfoption>
<hfoption id="langgraph">

```python
response = alfred.invoke({"messages": "¬øC√≥mo est√° el clima en Par√≠s esta noche? ¬øSer√° adecuado para nuestro espect√°culo de fuegos artificiales?"})

print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El clima en Par√≠s esta noche es lluvioso con una temperatura de 15¬∞C, lo que puede no ser adecuado para tu espect√°culo de fuegos artificiales.
```
</hfoption>
</hfoptions>

### Ejemplo 3: Impresionando a Investigadores de IA

Veamos c√≥mo Alfred puede ayudarnos a impresionar a los investigadores de IA.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
query = "Uno de nuestros invitados es de Qwen. ¬øQu√© puedes decirme sobre su modelo m√°s popular?"
response = alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El modelo m√°s popular de Qwen es Qwen/Qwen2.5-VL-7B-Instruct con 3,313,345 descargas.
```
</hfoption>
<hfoption id="llama-index">

```python
query = "Uno de nuestros invitados es de Google. ¬øQu√© puedes decirme sobre su modelo m√°s popular?"
response = await alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El modelo m√°s popular de Google en Hugging Face Hub es google/electra-base-discriminator, con 28,546,752 descargas.
```

</hfoption>
<hfoption id="langgraph">

```python
response = alfred.invoke({"messages": "Uno de nuestros invitados es de Qwen. ¬øQu√© puedes decirme sobre su modelo m√°s popular?"})

print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El modelo m√°s descargado de Qwen es Qwen/Qwen2.5-VL-7B-Instruct con 3,313,345 descargas.
```
</hfoption>
</hfoptions>

### Ejemplo 4: Combinando M√∫ltiples Herramientas

Veamos c√≥mo Alfred puede ayudarnos a prepararnos para una conversaci√≥n con el Dr. Nikola Tesla.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
query = "Necesito hablar con el Dr. Nikola Tesla sobre avances recientes en energ√≠a inal√°mbrica. ¬øPuedes ayudarme a prepararme para esta conversaci√≥n?"
response = alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
He reunido informaci√≥n para ayudarte a prepararte para tu conversaci√≥n con el Dr. Nikola Tesla.

Informaci√≥n del Invitado:
Nombre: Dr. Nikola Tesla
Relaci√≥n: viejo amigo de los d√≠as universitarios
Descripci√≥n: El Dr. Nikola Tesla es un viejo amigo de tus d√≠as universitarios. Recientemente ha patentado un nuevo sistema de transmisi√≥n de energ√≠a inal√°mbrica y estar√≠a encantado de discutirlo contigo. Solo recuerda que le apasionan las palomas, as√≠ que eso podr√≠a ser un buen tema para iniciar la conversaci√≥n.
Email: nikola.tesla@gmail.com

Avances Recientes en Energ√≠a Inal√°mbrica:
Bas√°ndome en mi b√∫squeda web, aqu√≠ hay algunos desarrollos recientes en transmisi√≥n de energ√≠a inal√°mbrica:
1. Los investigadores han avanzado en la transmisi√≥n de energ√≠a inal√°mbrica de largo alcance utilizando ondas electromagn√©ticas enfocadas
2. Varias empresas est√°n desarrollando tecnolog√≠as de acoplamiento inductivo resonante para electr√≥nica de consumo
3. Hay nuevas aplicaciones en la carga de veh√≠culos el√©ctricos sin conexiones f√≠sicas

Iniciadores de Conversaci√≥n:
1. "Me encantar√≠a conocer tu nueva patente sobre transmisi√≥n de energ√≠a inal√°mbrica. ¬øC√≥mo se compara con tus conceptos originales de nuestros d√≠as universitarios?"
2. "¬øHas visto los desarrollos recientes en acoplamiento inductivo resonante para electr√≥nica de consumo? ¬øQu√© opinas de su enfoque?"
3. "¬øC√≥mo est√°n tus palomas? Recuerdo tu fascinaci√≥n por ellas."

Esto deber√≠a darte mucho para discutir con el Dr. Tesla mientras demuestras tu conocimiento de sus intereses y desarrollos recientes en su campo.
```

</hfoption>
<hfoption id="llama-index">

```python
query = "Necesito hablar con el Dr. Nikola Tesla sobre avances recientes en energ√≠a inal√°mbrica. ¬øPuedes ayudarme a prepararme para esta conversaci√≥n?"
response = await alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
Aqu√≠ hay algunos avances recientes en energ√≠a inal√°mbrica que podr√≠an serte √∫tiles para tu conversaci√≥n con el Dr. Nikola Tesla:

1. **Avances y Desaf√≠os en la Transferencia de Energ√≠a Inal√°mbrica**: Este art√≠culo analiza la evoluci√≥n de la transferencia de energ√≠a inal√°mbrica (WPT) desde los m√©todos convencionales con cables hasta las aplicaciones modernas, incluidas las estaciones de energ√≠a espacial solar. Destaca el enfoque inicial en la tecnolog√≠a de microondas y la demanda actual de WPT debido al aumento de dispositivos el√©ctricos.

2. **Avances Recientes en Tecnolog√≠as de Transferencia de Energ√≠a Inal√°mbrica para Electr√≥nica Corporal**: Este art√≠culo explora la transferencia de energ√≠a inal√°mbrica (WET) como soluci√≥n para alimentar dispositivos electr√≥nicos corporales sin necesidad de bater√≠as o cables conductores. Analiza las ventajas y posibles aplicaciones de WET en este contexto.

3. **Transferencia de Energ√≠a Inal√°mbrica y Captaci√≥n de Energ√≠a: Estado Actual y Tendencias Futuras**: Este art√≠culo proporciona una visi√≥n general de los avances recientes en m√©todos de suministro de energ√≠a inal√°mbrica, incluida la captaci√≥n de energ√≠a y la transferencia de energ√≠a inal√°mbrica. Presenta varias aplicaciones prometedoras y analiza las tendencias futuras en el campo.

4. **Transferencia de Energ√≠a Inal√°mbrica: Aplicaciones, Desaf√≠os, Barreras y
```

</hfoption>
<hfoption id="langgraph">

```python
response = alfred.invoke({"messages":"Necesito hablar con el 'Dr. Nikola Tesla' sobre avances recientes en energ√≠a inal√°mbrica. ¬øPuedes ayudarme a prepararme para esta conversaci√≥n?"})

print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
```

Salida esperada:

```
Bas√°ndome en la informaci√≥n proporcionada, aqu√≠ hay puntos clave para prepararte para la conversaci√≥n con el 'Dr. Nikola Tesla' sobre avances recientes en energ√≠a inal√°mbrica:
1. **Transmisi√≥n de Energ√≠a Inal√°mbrica (WPT):** Comenta c√≥mo WPT revoluciona la transferencia de energ√≠a al eliminar la necesidad de cables y aprovechar mecanismos como el acoplamiento inductivo y resonante.
2. **Avances en Carga Inal√°mbrica:** Destaca las mejoras en eficiencia, velocidades de carga m√°s r√°pidas y el auge de soluciones de carga inal√°mbrica certificadas Qi/Qi2.
3. **Innovaciones 5G-Advanced y Protocolo Inal√°mbrico NearLink:** Menciona estos como desarrollos que mejoran la velocidad, seguridad y eficiencia en redes inal√°mbricas, que pueden soportar tecnolog√≠as avanzadas de energ√≠a inal√°mbrica.
4. **IA y ML en el Edge:** Habla sobre c√≥mo la inteligencia artificial y el aprendizaje autom√°tico depender√°n de redes inal√°mbricas para llevar inteligencia al borde, mejorando la automatizaci√≥n e inteligencia en hogares y edificios inteligentes.
5. **Avances en Matter, Thread y Seguridad:** Comenta estas innovaciones clave que impulsan la conectividad, eficiencia y seguridad en dispositivos y sistemas IoT.
6. **Avances en Tecnolog√≠a de Carga Inal√°mbrica:** Incluye avances recientes o estudios, como el de la Universidad Nacional de Incheon, para respaldar los avances en carga inal√°mbrica.
```
</hfoption>
</hfoptions>

### Ejemplo 3: Impresionando a Investigadores de IA

Veamos c√≥mo Alfred puede ayudarnos a impresionar a los investigadores de IA.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
query = "Uno de nuestros invitados es de Qwen. ¬øQu√© puedes decirme sobre su modelo m√°s popular?"
response = alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El modelo m√°s popular de Qwen es Qwen/Qwen2.5-VL-7B-Instruct con 3,313,345 descargas.
```
</hfoption>
<hfoption id="llama-index">

```python
query = "Uno de nuestros invitados es de Google. ¬øQu√© puedes decirme sobre su modelo m√°s popular?"
response = await alfred.run(query)

print("üé© Respuesta de Alfred:")
print(response)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El modelo m√°s popular de Google en Hugging Face Hub es google/electra-base-discriminator, con 28,546,752 descargas.
```

</hfoption>
<hfoption id="langgraph">

```python
response = alfred.invoke({"messages": "Uno de nuestros invitados es de Qwen. ¬øQu√© puedes decirme sobre su modelo m√°s popular?"})

print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
```

Salida esperada:

```
üé© Respuesta de Alfred:
El modelo m√°s descargado de Qwen es Qwen/Qwen2.5-VL-7B-Instruct con 3,313,345 descargas.
```
</hfoption>
</hfoptions>

## Caracter√≠sticas Avanzadas: Memoria de Conversaci√≥n

Para hacer que Alfred sea a√∫n m√°s √∫til durante la gala, podemos habilitar la memoria de conversaci√≥n para que recuerde interacciones previas:

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
# Crear Alfred con memoria de conversaci√≥n
alfred_with_memory = CodeAgent(
    tools=[guest_info_tool, weather_info_tool, hub_stats_tool, search_tool], 
    model=model,
    add_base_tools=True,
    planning_interval=3,
    memory=True  # Habilitar memoria de conversaci√≥n
)

# Primera interacci√≥n
response1 = alfred_with_memory.run("Cu√©ntame sobre Lady Ada Lovelace.")
print("üé© Primera Respuesta de Alfred:")
print(response1)

# Segunda interacci√≥n (haciendo referencia a la primera)
response2 = alfred_with_memory.run("¬øEn qu√© proyectos est√° trabajando actualmente?")
print("üé© Segunda Respuesta de Alfred:")
print(response2)
```

</hfoption>
<hfoption id="llama-index">

```python
from llama_index.core.workflow import Context

alfred = AgentWorkflow.from_tools_or_functions(
    [guest_info_tool, search_tool, weather_info_tool, hub_stats_tool],
    llm=llm
)

# Recordando el estado
ctx = Context(alfred)

# Primera interacci√≥n
response1 = await alfred.run("Cu√©ntame sobre Lady Ada Lovelace.", ctx=ctx)
print("üé© Primera Respuesta de Alfred:")
print(response1)

# Segunda interacci√≥n (haciendo referencia a la primera)
response2 = await alfred.run("¬øEn qu√© proyectos est√° trabajando actualmente?", ctx=ctx)
print("üé© Segunda Respuesta de Alfred:")
print(response2)
```

</hfoption>
<hfoption id="langgraph">

```python
# Primera interacci√≥n
response = alfred.invoke({"messages": [HumanMessage(content="Cu√©ntame sobre 'Lady Ada Lovelace'. ¬øCu√°l es su historia y c√≥mo est√° relacionada conmigo?")]})


print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
print()

# Segunda interacci√≥n (haciendo referencia a la primera)
response = alfred.invoke({"messages": response["messages"] + [HumanMessage(content="¬øEn qu√© proyectos est√° trabajando actualmente?")]})

print("üé© Respuesta de Alfred:")
print(response['messages'][-1].content)
```

</hfoption>
</hfoptions>

## Conclusi√≥n

¬°Felicitaciones! Has construido exitosamente a Alfred, un agente sofisticado equipado con m√∫ltiples herramientas para ayudar a organizar la gala m√°s extravagante del siglo. Alfred ahora puede:

1. Recuperar informaci√≥n detallada sobre los invitados
2. Verificar las condiciones clim√°ticas para planificar actividades al aire libre
3. Proporcionar informaci√≥n sobre influyentes creadores de IA y sus modelos
4. Buscar en la web la informaci√≥n m√°s reciente
5. Mantener el contexto de la conversaci√≥n con memoria

Con estas capacidades, Alfred est√° listo para asegurar que tu gala sea un √©xito rotundo, impresionando a los invitados con atenci√≥n personalizada e informaci√≥n actualizada.
